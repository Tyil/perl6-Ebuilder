#! /usr/bin/env perl6

use v6.c;

use Ebuilder;
use WWW;

sub MAIN
{
	# Get ecosystem META.list
	my Str $meta-list = get "https://raw.githubusercontent.com/perl6/ecosystem/master/META.list";

	for $meta-list.lines -> $line {
		try {
			CATCH {
				default {
					say "Failed $line: " ~ .Str;
					next;
				}
			}

			# Get meta
			$line
				==> get()
				==> from-json()
				==> my %meta
				;

			# TODO
			# Check the git repo itself to find out if there's tagged releases,
			# and create a specific ebuild for every release if they have

			my Str $ebuild = make-ebuild(%meta);
			my Str $atom-name = atom-name(%meta<name>, 9999);

			# Save ebuild
			spurt("{$atom-name}.ebuild", $ebuild);

			# Rejoice
			say "Saved $atom-name";
		}
	}
}
